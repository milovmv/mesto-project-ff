(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function n(e,t,o){var n=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),r=n.querySelector(".card__image"),c=n.querySelector(".card__title"),a=n.querySelector(".card__likes-number");return r.src=e.link,r.alt=e.name,c.textContent=e.name,a.textContent=e.likes,r.addEventListener("click",o),n}var r=function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popum__form__input_type_error"),o.classList.remove("popum__form__input-error_active"),o.textContent=""},c=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button_inactive")):(t.disabled=!0,t.classList.add("popup__button_inactive"))},a=function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(t){if(t.validity.valid)return t;r(e,t)}))};function i(e,t){return e.closest(".card").remove(),fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/cards/".concat(t),{method:"DELETE",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"}})}function u(e,t){var o=e.closest(".card__like-button");return o.classList.contains("card__like-button_is-active")?(o.classList.remove("card__like-button_is-active"),fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"}})):(o.classList.add("card__like-button_is-active"),fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"}}))}function l(e,t){var o=e.parentElement.querySelector(".card__likes-number");return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/cards/",{method:"GET",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return o.textContent=e[t].likes.length}))}var d,p=document.querySelector(".places__list"),s=document.querySelectorAll(".popup"),f=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),m=document.querySelector(".profile__image"),v=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),h=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),C=document.querySelector(".popup_type_new-avatar"),E=document.querySelector(".form__edit-profile"),k=document.querySelector(".popup__input_type_name"),L=document.querySelector(".popup__input_type_description"),g=document.querySelector(".form__new-place"),x=document.querySelector(".popup__input_type_card-name"),T=document.querySelector(".popup__input_type_url"),w=document.querySelector(".form__new-avatar"),j=document.querySelector(".popup__input_type_avatar-url"),A=q.querySelector(".popup__image"),z=q.querySelector(".popup__caption"),O=[],D=[],P=[];function G(t){A.src=t.target.src,A.alt=t.target.alt,z.textContent=t.target.alt,e(q)}function M(e){e.preventDefault(),v.textContent=k.value,y.textContent=L.value;var o=E.querySelector(".popup__button"),n=o.textContent;o.textContent="Сохранение...",o.disabled=!0,function(e,t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/users/me",{method:"PATCH",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e),about:"".concat(t)})})}(k.value,L.value).finally((function(){o.textContent=n,o.disabled=!1})),t(h)}function N(e){e.preventDefault(),b.style.backgroundImage="url(".concat(j.value,")");var o,n=w.querySelector(".popup__button"),r=n.textContent;n.textContent="Сохранение...",n.disabled=!0,(o=j.value,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/users/me/avatar",{method:"PATCH",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(o)})})).finally((function(){n.textContent=r,n.disabled=!1})),t(C)}function J(e){e.preventDefault();var o={};o.name=x.value,o.link=T.value;var r=g.querySelector(".popup__button"),c=r.textContent;r.textContent="Сохранение...",r.disabled=!0;var a=n(o,0,G);p.prepend(a),function(e,t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/cards",{method:"POST",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e),link:"".concat(t)})})}(x.value,T.value).finally((function(){r.textContent=c,r.disabled=!1})),a.querySelector(".card__delete-button").addEventListener("click",(function(){i(a,D[0]._id)}));var d=a.querySelector(".card__like-button");d.addEventListener("click",(function(){u(d,D[0]._id),l(d,0)})),t(S)}s.forEach((function(e){e.classList.add("popup_is-animated"),e.querySelector(".popup__close").addEventListener("click",(function(){t(e)})),e.addEventListener("mousedown",(function(o){o.target.classList.contains("popup")&&t(e)}))})),function(e,t,o){fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/users/me",{method:"GET",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(n){e.textContent=n.name,t.textContent=n.about,o.style.backgroundImage="url(".concat(n.avatar,")")}))}(v,y,b),Promise.all([function(e,t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/cards",{method:"GET",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(o){for(var n=0;n<o.length;n++)e.push({_id:"".concat(o[n].owner._id)}),t.push({_id:"".concat(o[n]._id)});return console.log(t[0]),t})).catch((function(e){return console.error("Ошибка при получении карточек:",e),[]}))}(O,D),function(e){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-39/cards",{method:"GET",headers:{authorization:"cb8cc2b3-c15b-4303-b84a-0af84ebd8a85","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){for(var o=0;o<t.length;o++)e.push({name:"".concat(t[o].name),link:"".concat(t[o].link),likes:"".concat(t[o].likes.length)});return e})).catch((function(e){return console.error("Ошибка при получении карточек:",e),[]}))}(P)]).then((function(e){P.forEach((function(e){var t=n(e,0,G);!function(e,t,o){var n=e.querySelector(".card__delete-button");"e1dc32dca280a12214f72aad"!=t[o]._id&&(n.disabled=!0,n.style.visibility="hidden")}(t,O,P.indexOf(e)),p.append(t)})),g.addEventListener("submit",J),E.addEventListener("submit",M),w.addEventListener("submit",N);var t=Array.from(document.querySelectorAll(".card__delete-button"));t.forEach((function(e){e.addEventListener("click",(function(){i(e,D[t.indexOf(e)]._id)}))}));var o=Array.from(document.querySelectorAll(".card__like-button"));console.log(o),o.forEach((function(e){e.addEventListener("click",(function(){u(e,D[o.indexOf(e)]._id),l(e,o.indexOf(e))}))}))})).catch((function(e){console.error("Произошла ошибка:",e)})),f.addEventListener("click",(function(){e(h),k.value=v.textContent,L.value=y.textContent,a(E,{inputSelector:".popup__input"})})),m.addEventListener("click",(function(){e(C),a(E,{inputSelector:".popup__input"})})),_.addEventListener("click",(function(){e(S),x.value="",T.value="";var t=g.querySelector(".button");t.disabled=!0,t.classList.add("popup__button_inactive"),a(g,{inputSelector:".popup__input"})})),d={formSelector:".popup__form"},Array.from(document.querySelectorAll(d.formSelector)).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".button");c(t,o),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?(t.dataset.errorMessage="Разрешены только латинские и кириллические буквы, знаки дефиса и пробелы.",t.setCustomValidity(t.dataset.errorMessage)):t.setCustomValidity(""),t.validity.valid?r(e,t):function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popum__form__input_type_error"),n.textContent=o,n.classList.add("popum__form__input-error_active")}(e,t,t.validationMessage)}(e,n),c(t,o)}))}))}(e)}))})();